"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.reset = exports.setAsync = exports.set = exports.addAsync = exports.add = void 0;

var _input = require("../plugins/input/");

var _fetchId = _interopRequireDefault(require("../util/fetchId"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) { try { var info = gen[key](arg); var value = info.value; } catch (error) { reject(error); return; } if (info.done) { resolve(value); } else { Promise.resolve(value).then(_next, _throw); } }

function _asyncToGenerator(fn) { return function () { var self = this, args = arguments; return new Promise(function (resolve, reject) { var gen = fn.apply(self, args); function _next(value) { asyncGeneratorStep(gen, resolve, reject, _next, _throw, "next", value); } function _throw(err) { asyncGeneratorStep(gen, resolve, reject, _next, _throw, "throw", err); } _next(undefined); }); }; }

const add = function add(data, options = {}, log = false) {
  if (options === true || log === true) {
    this.save();
  }

  this.data.push(...(0, _input.chain)(data, options));
  this.data.filter(entry => !entry.hasOwnProperty('id')).forEach(entry => {
    entry.id = (0, _fetchId.default)(this.getIds(), 'temp_id_');
  });
  return this;
};

exports.add = add;

const addAsync = function () {
  var _ref = _asyncToGenerator(function* (data, options = {}, log = false) {
    if (options === true || log === true) {
      this.save();
    }

    this.data.push(...(yield (0, _input.chainAsync)(data, options)));
    this.data.filter(entry => !entry.hasOwnProperty('id')).forEach(entry => {
      entry.id = (0, _fetchId.default)(this.getIds(), 'temp_id_');
    });
    return this;
  });

  return function addAsync(_x) {
    return _ref.apply(this, arguments);
  };
}();

exports.addAsync = addAsync;

const set = function set(data, options = {}, log = false) {
  if (options === true || log === true) {
    this.save();
  }

  this.data = [];
  return typeof options !== 'boolean' ? this.add(data, options) : this.add(data);
};

exports.set = set;

const setAsync = function () {
  var _ref2 = _asyncToGenerator(function* (data, options = {}, log = false) {
    if (options === true || log === true) {
      this.save();
    }

    this.data = [];
    return typeof options !== 'boolean' ? this.addAsync(data, options) : this.addAsync(data);
  });

  return function setAsync(_x2) {
    return _ref2.apply(this, arguments);
  };
}();

exports.setAsync = setAsync;

const reset = function reset(log) {
  if (log) {
    this.save();
  }

  this.data = [];
  this._options = {};
  return this;
};

exports.reset = reset;